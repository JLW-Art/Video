<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Video Synth V1.02</title><style>html,body{margin:0;padding:0;width:100vw;height:100vh;overflow:auto;background-color:#2d2d2d;font-family:Arial,sans-serif;font-size:14px;box-sizing:border-box}#container{display:flex;flex-direction:row;gap:10px;padding:10px;width:100%;height:100%;box-sizing:border-box}#canvasContainer{flex:1;display:flex;align-items:center;justify-content:center;padding:10px}#simulationCanvas{background-color:black;border-radius:10px;box-shadow:0 4px 15px rgba(0,0,0,0.5);cursor:pointer}#controls{width:400px;background-color:#333;padding:10px 15px 15px 15px;border-radius:10px;box-sizing:border-box;overflow-y:auto;color:#f0f0f0}@media (max-width:600px){#container{flex-direction:column}#controls{width:100%}}#controls h2{font-size:18px;margin:0 0 10px 0;position:relative}.by-jlw{position:absolute;top:0;right:0;font-size:10px}.by-jlw a{color:#ccc;text-decoration:none}.by-jlw a:hover{text-decoration:underline}#toggles{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:15px}.toggle-container{display:flex;align-items:center;gap:5px;font-size:14px;padding:5px 8px;background-color:#444;border-radius:5px}input[type="checkbox"]{-webkit-appearance:none;width:18px;height:18px;border:2px solid #007acc;border-radius:3px;position:relative;cursor:pointer;outline:none}input[type="checkbox"]:checked{background-color:#007acc}input[type="checkbox"]:checked::after{content:"";position:absolute;left:4px;top:0;width:4px;height:10px;border:solid #f0f0f0;border-width:0 2px 2px 0;transform:rotate(45deg)}#sliders{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:15px}.slider-container{padding:5px;background-color:#444;border-radius:5px}.slider-label{display:inline-block;margin-bottom:3px;font-size:14px}.editable-number{cursor:pointer;border-bottom:1px dotted transparent}.editable-number:hover{border-bottom-color:#007acc}input[type="range"]{-webkit-appearance:none;width:100%;background:transparent}input[type="range"]::-webkit-slider-thumb{-webkit-appearance:none;background:#007acc;border:none;border-radius:50%;width:16px;height:16px;margin-top:-6px;cursor:pointer}input[type="range"]::-webkit-slider-runnable-track{height:4px;background:#646464;border-radius:2px}input[type="range"]:focus{outline:none}#curveEditors{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:15px}.curve-editor-container{position:relative}.curve-editor{width:180px;height:120px;border:1px solid #646464;background-color:#444;border-radius:5px;cursor:crosshair}.curve-editor-reset{position:absolute;top:5px;right:5px;z-index:10;background-color:#007acc;color:#f0f0f0;border:none;border-radius:3px;padding:2px 5px;cursor:pointer}#buttons{display:flex;justify-content:space-around;gap:10px}.button{padding:10px 15px;background-color:#505050;border:none;border-radius:5px;color:#f0f0f0;cursor:pointer;font-size:14px}.button:hover{background-color:#007acc}</style></head><body><div id="container"><div id="canvasContainer"><canvas id="simulationCanvas"></canvas></div><div id="controls"><h2>Video Synth <span style="font-size:0.7em;color:#888;">v1.02</span><span class="by-jlw"><a href="https://jlw.kleio.com" target="_blank">by JLW</a></span></h2><div id="toggles"></div><div id="sliders"></div><div id="curveEditors"></div><div id="buttons"></div></div></div><script>const DEFAULT_PARAMS={resolution_scale:1.0,displacement_intensity:0.005,scale:5.0,speed:0.1,rotation_angle:0.0,wave_amplitude:30.0,wave_frequency:1.0,zoom_level:1.0,edge_detection:false,invert_colors:false,initial_pattern_toggle:false,checkerboard_pattern:false,spiral_pattern:false,cross_pattern:false,concentric_circles_pattern:false,diagonal_lines_pattern:false,triangle_pattern:false,effect:false,r_curve_points:[{x:0,y:0},{x:1,y:1}],g_curve_points:[{x:0,y:0},{x:1,y:1}],b_curve_points:[{x:0,y:0},{x:1,y:1}],w_curve_points:[{x:0,y:0},{x:1,y:1}],rgb_shift_intensity:0.0,noise_intensity:0.0,sharpening_intensity:0.0};let controlParams=JSON.parse(JSON.stringify(DEFAULT_PARAMS));const FPS=30,CONTROL_PANEL_WIDTH=400,BASE_ANIMATION_RENDER_WIDTH_LANDSCAPE=320,BASE_ANIMATION_RENDER_HEIGHT_LANDSCAPE=180,BASE_ANIMATION_RENDER_WIDTH_PORTRAIT=180,BASE_ANIMATION_RENDER_HEIGHT_PORTRAIT=320;let ASPECT_RATIO_LANDSCAPE=true,ANIMATION_RENDER_WIDTH=0,ANIMATION_RENDER_HEIGHT=0,ANIMATION_DISPLAY_WIDTH=0,ANIMATION_DISPLAY_HEIGHT=0;const UI_BG="#2d2d2d",UI_TEXT="#f0f0f0",UI_ACCENT="#007acc",UI_SLIDER_LINE="#646464",UI_GRID="#3c3c3c",UI_BUTTON="#505050";let displacementXBase=[],displacementYBase=[],initialImage=null,simulationCanvas,simCtx,frame=0,lastTime=0,X_anim=[],Y_anim=[];function copyImage(image){const height=image.length;let newImage=new Array(height);for(let i=0;i<height;i++){const width=image[i].length;newImage[i]=new Array(width);for(let j=0;j<width;j++){newImage[i][j]=image[i][j].slice()}}return newImage}function updateRenderDimensions(){let baseWidth,baseHeight;if(ASPECT_RATIO_LANDSCAPE){baseWidth=BASE_ANIMATION_RENDER_WIDTH_LANDSCAPE;baseHeight=BASE_ANIMATION_RENDER_HEIGHT_LANDSCAPE}else{baseWidth=BASE_ANIMATION_RENDER_WIDTH_PORTRAIT;baseHeight=BASE_ANIMATION_RENDER_HEIGHT_PORTRAIT}let currentScale=controlParams.resolution_scale;if(document.fullscreenElement){if(ASPECT_RATIO_LANDSCAPE){if(ANIMATION_DISPLAY_HEIGHT<180)currentScale=1.5}else{if(ANIMATION_DISPLAY_WIDTH<180)currentScale=1.5}}let renderWidth=Math.floor(baseWidth*currentScale),renderHeight=Math.floor(baseHeight*currentScale),maxWidth=640,maxHeight=360;if(renderWidth>maxWidth||renderHeight>maxHeight){currentScale=Math.min(maxWidth/baseWidth,maxHeight/baseHeight);renderWidth=Math.floor(baseWidth*currentScale);renderHeight=Math.floor(baseHeight*currentScale)}ANIMATION_RENDER_WIDTH=renderWidth;ANIMATION_RENDER_HEIGHT=renderHeight}function updateCanvasSize(){const isMobile=window.innerWidth<600;let availableWidth,availableHeight;if(isMobile){availableWidth=window.innerWidth-20;availableHeight=window.innerHeight*0.7}else{const horizontalPadding=20,verticalPadding=20;availableWidth=window.innerWidth-CONTROL_PANEL_WIDTH-horizontalPadding;availableHeight=window.innerHeight-verticalPadding}const ratio=ASPECT_RATIO_LANDSCAPE?16/9:9/16;let canvasWidth,canvasHeight;if(availableWidth/ratio<=availableHeight){canvasWidth=availableWidth;canvasHeight=availableWidth/ratio}else{canvasHeight=availableHeight;canvasWidth=availableHeight*ratio}simulationCanvas.width=canvasWidth;simulationCanvas.height=canvasHeight;ANIMATION_DISPLAY_WIDTH=canvasWidth;ANIMATION_DISPLAY_HEIGHT=canvasHeight}function initializeDisplacementBase(){displacementXBase=[];displacementYBase=[];for(let i=0;i<ANIMATION_RENDER_HEIGHT;i++){let rowX=[],rowY=[];for(let j=0;j<ANIMATION_RENDER_WIDTH;j++){rowX.push(Math.random()-0.5);rowY.push(Math.random()-0.5)}displacementXBase.push(rowX);displacementYBase.push(rowY)}}function createInitialImage(){let image=[];if(controlParams.initial_pattern_toggle){let cx=ANIMATION_RENDER_WIDTH/2,cy=ANIMATION_RENDER_HEIGHT/2,maxDist=Math.sqrt(cx*cx+cy*cy);for(let i=0;i<ANIMATION_RENDER_HEIGHT;i++){let row=[];for(let j=0;j<ANIMATION_RENDER_WIDTH;j++){let dx=j-cx,dy=i-cy,dist=Math.sqrt(dx*dx+dy*dy),intensity=1-(dist/maxDist);intensity=Math.max(0,Math.min(1,intensity));row.push([intensity,intensity,intensity])}image.push(row)}return image}for(let i=0;i<ANIMATION_RENDER_HEIGHT;i++){let row=[];for(let j=0;j<ANIMATION_RENDER_WIDTH;j++){let pixel=[0,0,0];if(controlParams.checkerboard_pattern){const tileSize=10;let board=((Math.floor(i/tileSize)+Math.floor(j/tileSize))%2===0)?0.1:0.9;pixel=[board,board,board]}else if(controlParams.spiral_pattern){let xCentered=j-ANIMATION_RENDER_WIDTH/2,yCentered=i-ANIMATION_RENDER_HEIGHT/2,r=Math.sqrt(xCentered*xCentered+yCentered*yCentered),angle=Math.atan2(yCentered,xCentered),val=(Math.sin(0.1*r+angle*5)+1)/2;pixel=[val,val,val]}else if(controlParams.cross_pattern){let cx=Math.floor(ANIMATION_RENDER_WIDTH/2),cy=Math.floor(ANIMATION_RENDER_HEIGHT/2),crossThickness=4;pixel=[0.1,0.1,0.1];if(Math.abs(i-cy)<crossThickness||Math.abs(j-cx)<crossThickness)pixel=[0.9,0.9,0.9]}else if(controlParams.concentric_circles_pattern){let xCentered=j-ANIMATION_RENDER_WIDTH/2,yCentered=i-ANIMATION_RENDER_HEIGHT/2,r=Math.sqrt(xCentered*xCentered+yCentered*yCentered),val=(Math.sin(0.1*r)+1)/2;pixel=[val,val,val]}else if(controlParams.diagonal_lines_pattern){const lineSpacing=20;let mask=((i+j)%(2*lineSpacing))<lineSpacing?0.9:0.1;pixel=[mask,mask,mask]}else if(controlParams.triangle_pattern){let v1={x:ANIMATION_RENDER_WIDTH/2,y:0},v2={x:0,y:ANIMATION_RENDER_HEIGHT-1},v3={x:ANIMATION_RENDER_WIDTH-1,y:ANIMATION_RENDER_HEIGHT-1};if(pointInTriangle({x:j,y:i},v1,v2,v3))pixel=[0.9,0.9,0.9];else pixel=[0.1,0.1,0.1]}else{const colours=[[0,0,0],[1,0,1],[1,0,0],[0,1,1]];let stripeHeight=Math.floor(ANIMATION_RENDER_HEIGHT/colours.length),idx=Math.min(Math.floor(i/stripeHeight),colours.length-1);pixel=colours[idx]}row.push(pixel)}image.push(row)}return image}function pointInTriangle(p,a,b,c){let areaOrig=Math.abs((b.x-a.x)*(c.y-a.y)-(c.x-a.x)*(b.y-a.y)),area1=Math.abs((a.x-p.x)*(b.y-p.y)-(b.x-p.x)*(a.y-p.y)),area2=Math.abs((b.x-p.x)*(c.y-p.y)-(c.x-p.x)*(b.y-p.y)),area3=Math.abs((c.x-p.x)*(a.y-p.y)-(a.x-p.x)*(c.y-p.y));return Math.abs(area1+area2+area3-areaOrig)<1}function initializeSimulation(){updateRenderDimensions();updateCanvasSize();initializeDisplacementBase();X_anim=[];Y_anim=[];for(let i=0;i<ANIMATION_RENDER_HEIGHT;i++){let rowX=[],rowY=[];for(let j=0;j<ANIMATION_RENDER_WIDTH;j++){rowX.push(j);rowY.push(i)}X_anim.push(rowX);Y_anim.push(rowY)}initialImage=createInitialImage()}function generateDisplacementFields(t){let dX=[],dY=[];if(controlParams.effect){for(let i=0;i<ANIMATION_RENDER_HEIGHT;i++){let rowX=[],rowY=[];for(let j=0;j<ANIMATION_RENDER_WIDTH;j++){let dValX=0,dValY=0;for(let n=1;n<=5;n++){let f=n*0.1*controlParams.wave_frequency*controlParams.scale,phase=t*n*0.5*controlParams.speed;dValX+=Math.sin(f*j+phase)*(controlParams.displacement_intensity*100*controlParams.wave_amplitude)/n;dValY+=Math.cos(f*i+phase)*(controlParams.displacement_intensity*100*controlParams.wave_amplitude)/n}rowX.push(dValX);rowY.push(dValY)}dX.push(rowX);dY.push(rowY)}return [dX,dY]}for(let i=0;i<ANIMATION_RENDER_HEIGHT;i++){let rowX=[],rowY=[];for(let j=0;j<ANIMATION_RENDER_WIDTH;j++){let waveX=controlParams.wave_amplitude*Math.sin(controlParams.wave_frequency*controlParams.scale*(j+i)+controlParams.speed*t),waveY=controlParams.wave_amplitude*Math.cos(controlParams.wave_frequency*controlParams.scale*(j-i)+controlParams.speed*t),noiseDisp=controlParams.displacement_intensity*100.0;rowX.push(displacementXBase[i][j]*noiseDisp+waveX);rowY.push(displacementYBase[i][j]*noiseDisp+waveY)}dX.push(rowX);dY.push(rowY)}return [dX,dY]}function applyDisplacement(image,dX,dY,t){let result=[];const angleRad=controlParams.rotation_angle*Math.PI/180,cosA=Math.cos(angleRad),sinA=Math.sin(angleRad),cx=ANIMATION_RENDER_WIDTH/2,cy=ANIMATION_RENDER_HEIGHT/2;for(let i=0;i<ANIMATION_RENDER_HEIGHT;i++){let row=[];for(let j=0;j<ANIMATION_RENDER_WIDTH;j++){let xOrig=j-cx,yOrig=i-cy,xRot=xOrig*cosA-yOrig*sinA,yRot=xOrig*sinA+yOrig*cosA;xRot*=controlParams.zoom_level;yRot*=controlParams.zoom_level;let xNew=Math.floor((xRot+cx+dX[i][j])%ANIMATION_RENDER_WIDTH),yNew=Math.floor((yRot+cy+dY[i][j])%ANIMATION_RENDER_HEIGHT);if(xNew<0)xNew+=ANIMATION_RENDER_WIDTH;if(yNew<0)yNew+=ANIMATION_RENDER_HEIGHT;row.push(image[yNew][xNew])}result.push(row)}return result}function edgeDetection(image){let result=copyImage(image),height=ANIMATION_RENDER_HEIGHT,width=ANIMATION_RENDER_WIDTH;for(let i=1;i<height-1;i++){for(let j=1;j<width-1;j++){let gx=image[i][j+1][0]-image[i][j-1][0],gy=image[i+1][j][0]-image[i-1][j][0],mag=Math.sqrt(gx*gx+gy*gy),edgeVal=Math.min(1,mag);result[i][j]=[edgeVal,edgeVal,edgeVal]}}return result}function applyRGBShift(image,intensity){if(intensity<=0)return image;let result=copyImage(image),width=ANIMATION_RENDER_WIDTH,height=ANIMATION_RENDER_HEIGHT,shift=Math.floor(intensity);for(let i=0;i<height;i++){for(let j=0;j<width;j++){let redCol=(j+shift)%width,greenRow=(i+shift)%height,blueRow=(i+shift)%height,blueCol=(j+shift)%width;result[i][j][0]=image[i][redCol][0];result[i][j][1]=image[greenRow][j][1];result[i][j][2]=image[blueRow][blueCol][2]}}return result}function applyNoise(image,intensity){if(intensity<=0)return image;let result=copyImage(image),height=ANIMATION_RENDER_HEIGHT,width=ANIMATION_RENDER_WIDTH;for(let i=0;i<height;i++){for(let j=0;j<width;j++){for(let c=0;c<3;c++){let noise=Math.random();result[i][j][c]=(1-intensity)*image[i][j][c]+intensity*noise}}}return result}function applySharpening(image,intensity){if(intensity<=0)return image;let result=copyImage(image),kernel=[[0,-1,0],[-1,4+intensity,-1],[0,-1,0]],height=ANIMATION_RENDER_HEIGHT,width=ANIMATION_RENDER_WIDTH;for(let i=1;i<height-1;i++){for(let j=1;j<width-1;j++){let newPixel=[0,0,0];for(let ki=-1;ki<=1;ki++){for(let kj=-1;kj<=1;kj++){for(let c=0;c<3;c++){newPixel[c]+=image[i+ki][j+kj][c]*kernel[ki+1][kj+1]}}}for(let c=0;c<3;c++){newPixel[c]=Math.min(1,Math.max(0,newPixel[c]))}result[i][j]=newPixel}}return result}function linearInterp(x,xp,fp){if(x<=xp[0])return fp[0];if(x>=xp[xp.length-1])return fp[fp.length-1];for(let i=0;i<xp.length-1;i++){if(x>=xp[i]&&x<=xp[i+1]){let t=(x-xp[i])/(xp[i+1]-xp[i]);return fp[i]+t*(fp[i+1]-fp[i])}}return 0}function applyRGBWCurves(image){let rCurve=controlParams.r_curve_points,gCurve=controlParams.g_curve_points,bCurve=controlParams.b_curve_points,wCurve=controlParams.w_curve_points,r_x=rCurve.map(p=>p.x),r_y=rCurve.map(p=>p.y),g_x=gCurve.map(p=>p.x),g_y=gCurve.map(p=>p.y),b_x=bCurve.map(p=>p.x),b_y=bCurve.map(p=>p.y),w_x=wCurve.map(p=>p.x),w_y=wCurve.map(p=>p.y),result=copyImage(image),height=ANIMATION_RENDER_HEIGHT,width=ANIMATION_RENDER_WIDTH;for(let i=0;i<height;i++){for(let j=0;j<width;j++){let r=image[i][j][0],g=image[i][j][1],b=image[i][j][2],r_adj=linearInterp(r,r_x,r_y),g_adj=linearInterp(g,g_x,g_y),b_adj=linearInterp(b,b_x,b_y),lum=(r_adj+g_adj+b_adj)/3,w_adj=linearInterp(lum,w_x,w_y),scaleFactor=w_adj/(lum+1e-5);result[i][j][0]=Math.min(1,Math.max(0,r_adj*scaleFactor));result[i][j][1]=Math.min(1,Math.max(0,g_adj*scaleFactor));result[i][j][2]=Math.min(1,Math.max(0,b_adj*scaleFactor))}}return result}function drawImage(imageArray){const imgData=simCtx.createImageData(ANIMATION_RENDER_WIDTH,ANIMATION_RENDER_HEIGHT);for(let i=0;i<ANIMATION_RENDER_HEIGHT;i++){for(let j=0;j<ANIMATION_RENDER_WIDTH;j++){const index=(i*ANIMATION_RENDER_WIDTH+j)*4,pixel=imageArray[i][j];imgData.data[index]=pixel[0]*255;imgData.data[index+1]=pixel[1]*255;imgData.data[index+2]=pixel[2]*255;imgData.data[index+3]=255}}let offCanvas=document.createElement("canvas");offCanvas.width=ANIMATION_RENDER_WIDTH;offCanvas.height=ANIMATION_RENDER_HEIGHT;let offCtx=offCanvas.getContext("2d");offCtx.putImageData(imgData,0,0);simCtx.clearRect(0,0,simulationCanvas.width,simulationCanvas.height);simCtx.drawImage(offCanvas,0,0,ANIMATION_DISPLAY_WIDTH,ANIMATION_DISPLAY_HEIGHT)}function mainLoop(timestamp){if(!lastTime)lastTime=timestamp;let dt=(timestamp-lastTime)/1000;lastTime=timestamp;frame++;let t=frame/FPS;const[dX,dY]=generateDisplacementFields(t);let dispImage=applyDisplacement(initialImage,dX,dY,t);if(controlParams.edge_detection)dispImage=edgeDetection(dispImage);dispImage=applyRGBShift(dispImage,controlParams.rgb_shift_intensity);dispImage=applyNoise(dispImage,controlParams.noise_intensity);if(controlParams.invert_colors){const height=ANIMATION_RENDER_HEIGHT,width=ANIMATION_RENDER_WIDTH;for(let i=0;i<height;i++){for(let j=0;j<width;j++){dispImage[i][j]=dispImage[i][j].map(v=>1-v)}}}dispImage=applySharpening(dispImage,controlParams.sharpening_intensity);dispImage=applyRGBWCurves(dispImage);drawImage(dispImage);requestAnimationFrame(mainLoop)}function makeEditableNumber(span,sliderInput,info){span.addEventListener("click",function(e){e.stopPropagation();const numberInput=document.createElement("input");numberInput.type="number";numberInput.value=sliderInput.value;numberInput.min=info.min;numberInput.max=info.max;numberInput.step=info.step;numberInput.style.fontSize="14px";numberInput.style.width="50px";span.replaceWith(numberInput);setTimeout(()=>{numberInput.focus()},100);numberInput.addEventListener("keydown",function(e){if(e.key==="Enter")numberInput.blur()});numberInput.addEventListener("blur",function(){let newValue=parseFloat(numberInput.value);newValue=Math.min(Math.max(newValue,parseFloat(info.min)),parseFloat(info.max));sliderInput.value=newValue;controlParams[info.name]=newValue;span.textContent=newValue;numberInput.replaceWith(span);const label=sliderInput.parentElement.querySelector(".slider-label");if(label){label.innerHTML=info.label+": <span class='editable-number'>"+newValue+"</span>";const newSpan=label.querySelector(".editable-number");makeEditableNumber(newSpan,sliderInput,info)}if(info.name==="resolution_scale")initializeSimulation()})})}function setupUI(){const togglesDiv=document.getElementById("toggles");togglesDiv.innerHTML="";const allToggles=[{name:"edge_detection",label:"Enable Edge Detection"},{name:"invert_colors",label:"Invert Colours"},{name:"effect",label:"Effect"},{name:"initial_pattern_toggle",label:"Sunburst Pattern"},{name:"checkerboard_pattern",label:"Checkerboard Pattern"},{name:"spiral_pattern",label:"Spiral Pattern"},{name:"cross_pattern",label:"Cross Pattern"},{name:"concentric_circles_pattern",label:"Concentric Circles"},{name:"diagonal_lines_pattern",label:"Diagonal Lines"},{name:"triangle_pattern",label:"Triangle Pattern"}];const patternGroup=["initial_pattern_toggle","checkerboard_pattern","spiral_pattern","cross_pattern","concentric_circles_pattern","diagonal_lines_pattern","triangle_pattern"];allToggles.forEach(info=>{const container=document.createElement("div");container.className="toggle-container";const input=document.createElement("input");input.type="checkbox";input.id=info.name;input.checked=controlParams[info.name];input.onchange=function(){if(patternGroup.includes(info.name)&&this.checked){allToggles.forEach(other=>{if(patternGroup.includes(other.name)&&other.name!==info.name){controlParams[other.name]=false;const otherInput=document.getElementById(other.name);if(otherInput)otherInput.checked=false}});controlParams[info.name]=true}else{controlParams[info.name]=this.checked}initialImage=createInitialImage()};const label=document.createElement("label");label.htmlFor=info.name;label.innerText=info.label;container.appendChild(input);container.appendChild(label);togglesDiv.appendChild(container)});const sliderInfo=[{name:"resolution_scale",label:"Resolution Scale",min:0.5,max:2.0,step:0.01,value:controlParams.resolution_scale},{name:"displacement_intensity",label:"Displacement Intensity",min:0.001,max:0.02,step:0.0001,value:controlParams.displacement_intensity},{name:"scale",label:"Pattern Scale",min:1.0,max:100.0,step:1,value:controlParams.scale},{name:"speed",label:"Animation Speed",min:0.01,max:10.5,step:0.01,value:controlParams.speed},{name:"rotation_angle",label:"Rotation Angle",min:-180,max:180,step:1,value:controlParams.rotation_angle},{name:"wave_amplitude",label:"Wave Amplitude",min:0.0,max:150.0,step:1,value:controlParams.wave_amplitude},{name:"wave_frequency",label:"Wave Frequency",min:0.1,max:100.0,step:0.1,value:controlParams.wave_frequency},{name:"zoom_level",label:"Zoom Level",min:0.5,max:2.0,step:0.01,value:controlParams.zoom_level},{name:"rgb_shift_intensity",label:"RGB Shift",min:0.0,max:20.0,step:0.1,value:controlParams.rgb_shift_intensity},{name:"noise_intensity",label:"Noise Intensity",min:0.0,max:1.0,step:0.01,value:controlParams.noise_intensity},{name:"sharpening_intensity",label:"Sharpening",min:0.0,max:5.0,step:0.1,value:controlParams.sharpening_intensity}];const slidersDiv=document.getElementById("sliders");slidersDiv.innerHTML="";sliderInfo.forEach(info=>{const container=document.createElement("div");container.className="slider-container";const label=document.createElement("label");label.className="slider-label";const numberSpan=document.createElement("span");numberSpan.className="editable-number";numberSpan.textContent=info.value;label.innerHTML=info.label+": ";label.appendChild(numberSpan);const input=document.createElement("input");input.type="range";input.min=info.min;input.max=info.max;input.step=info.step;input.value=info.value;input.oninput=function(){controlParams[info.name]=parseFloat(this.value);numberSpan.textContent=this.value;if(info.name==="resolution_scale")initializeSimulation()};makeEditableNumber(numberSpan,input,info);container.appendChild(label);container.appendChild(input);slidersDiv.appendChild(container)});const curveEditorsDiv=document.getElementById("curveEditors");curveEditorsDiv.innerHTML="";const channels=[{key:"r",label:"Red Curve"},{key:"g",label:"Green Curve"},{key:"b",label:"Blue Curve"},{key:"w",label:"White Curve"}];channels.forEach(chObj=>{const container=document.createElement("div");container.className="curve-editor-container";container.style.position="relative";const label=document.createElement("div");label.innerText=chObj.label+": ";label.style.fontSize="14px";label.style.marginBottom="5px";container.appendChild(label);const editor=new CurveEditor(chObj.key,180,120);container.appendChild(editor.canvas);container.appendChild(editor.resetButton);curveEditorsDiv.appendChild(container);editor.draw()});const buttonsDiv=document.getElementById("buttons");buttonsDiv.innerHTML="";const restartBtn=document.createElement("button");restartBtn.className="button";restartBtn.innerText="Restart";restartBtn.onclick=function(){controlParams=JSON.parse(JSON.stringify(DEFAULT_PARAMS));initializeSimulation();updateLayout()};const flipAspectBtn=document.createElement("button");flipAspectBtn.className="button";flipAspectBtn.innerText="Toggle Orientation";flipAspectBtn.onclick=function(){ASPECT_RATIO_LANDSCAPE=!ASPECT_RATIO_LANDSCAPE;initializeSimulation();updateLayout()};buttonsDiv.appendChild(restartBtn);buttonsDiv.appendChild(flipAspectBtn)}class CurveEditor{constructor(name,width,height){this.name=name;this.width=width;this.height=height;this.canvas=document.createElement("canvas");this.canvas.width=width;this.canvas.height=height;this.canvas.className="curve-editor";this.ctx=this.canvas.getContext("2d");this.points=controlParams[this.name+"_curve_points"];this.draggingPoint=null;this.resetButton=document.createElement("button");this.resetButton.innerText="x";this.resetButton.className="curve-editor-reset";this.resetButton.onclick=(e)=>{e.stopPropagation();this.points=[{x:0,y:0},{x:1,y:1}];controlParams[this.name+"_curve_points"]=this.points;this.draw()};this.canvas.addEventListener("mousedown",e=>this.onMouseDown(e));this.canvas.addEventListener("mousemove",e=>this.onMouseMove(e));this.canvas.addEventListener("mouseup",e=>this.onMouseUp(e));this.canvas.addEventListener("mouseleave",e=>this.onMouseUp(e));this.canvas.addEventListener("click",e=>this.onClick(e))}draw(){this.ctx.clearRect(0,0,this.width,this.height);this.ctx.fillStyle=UI_BG;this.ctx.fillRect(0,0,this.width,this.height);this.ctx.strokeStyle=UI_GRID;for(let i=1;i<10;i++){this.ctx.beginPath();this.ctx.moveTo(0,i*this.height/10);this.ctx.lineTo(this.width,i*this.height/10);this.ctx.stroke();this.ctx.beginPath();this.ctx.moveTo(i*this.width/10,0);this.ctx.lineTo(i*this.width/10,this.height);this.ctx.stroke()}this.ctx.strokeStyle=UI_ACCENT;this.ctx.lineWidth=2;this.ctx.beginPath();let sorted=this.points.slice().sort((a,b)=>a.x-b.x);for(let i=0;i<sorted.length;i++){let pt=sorted[i],x=pt.x*this.width,y=(1-pt.y)*this.height;if(i===0)this.ctx.moveTo(x,y);else this.ctx.lineTo(x,y)}this.ctx.stroke();for(let pt of sorted){let x=pt.x*this.width,y=(1-pt.y)*this.height;this.ctx.fillStyle=UI_ACCENT;this.ctx.beginPath();this.ctx.arc(x,y,4,0,2*Math.PI);this.ctx.fill()}this.ctx.fillStyle=UI_TEXT;this.ctx.font="14px sans-serif";this.ctx.fillText(this.name.toUpperCase()+" Curve",5,20)}getMousePos(e){let rect=this.canvas.getBoundingClientRect();return{x:e.clientX-rect.left,y:e.clientY-rect.top}}onMouseDown(e){let pos=this.getMousePos(e);for(let i=0;i<this.points.length;i++){let pt=this.points[i],x=pt.x*this.width,y=(1-pt.y)*this.height;if(Math.hypot(pos.x-x,pos.y-y)<5){this.draggingPoint=i;return}}}onMouseMove(e){if(this.draggingPoint!==null){let pos=this.getMousePos(e),newX=pos.x/this.width,newY=1-(pos.y/this.height);newX=Math.min(Math.max(newX,0),1);newY=Math.min(Math.max(newY,0),1);this.points[this.draggingPoint]={x:newX,y:newY};controlParams[this.name+"_curve_points"]=this.points;this.draw()}}onMouseUp(e){this.draggingPoint=null}onClick(e){let pos=this.getMousePos(e),newX=pos.x/this.width,newY=1-(pos.y/this.height);for(let pt of this.points){let x=pt.x*this.width,y=(1-pt.y)*this.height;if(Math.hypot(pos.x-x,pos.y-y)<5)return}this.points.push({x:newX,y:newY});this.points.sort((a,b)=>a.x-b.x);controlParams[this.name+"_curve_points"]=this.points;this.draw()}}function updateLayout(){updateCanvasSize();setupUI()}window.onload=function(){simulationCanvas=document.getElementById("simulationCanvas");simCtx=simulationCanvas.getContext("2d");simulationCanvas.addEventListener("click",function(e){if(!document.fullscreenElement){simulationCanvas.requestFullscreen().catch(err=>{console.error("Error enabling full screen:",err)})}else{document.exitFullscreen()}});initializeSimulation();updateLayout();window.addEventListener("resize",updateLayout);document.addEventListener("fullscreenchange",()=>{initializeSimulation();updateLayout()});requestAnimationFrame(mainLoop)}</script></body></html>
